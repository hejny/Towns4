<?php//----------------------------------------------------------------------------------------------------------------------Name,Textif(isset($GLOBALS['get']['id'])) {    $GLOBALS['ss']['apps_edit_id']=intval($GLOBALS['get']["id"]);}if($_POST['apps_send']){    $id=intval($_POST['apps_id']);    $apps_name=trim($_POST['apps_name']);    $apps_editor=trim($_POST['apps_editor']);    $apps_index=trim($_POST['apps_index']);    $apps_description=trim($_POST['apps_description']);    $apps_permalink=trim($_POST['apps_permalink']);}elseif($GLOBALS['ss']['apps_edit_id']){    $id=$GLOBALS['ss']['apps_edit_id'];    list($apps_name,$profile,$apps_permalink)=sql_row("SELECT name,profile,permalink FROM [mpx]pos_obj WHERE id=".$id." AND `own`=".$GLOBALS['ss']['logid']." AND type='app' AND ".objt());    $profile=str2list($profile);    $apps_description=$profile['description'];    $apps_editor=$profile['editor'];    $apps_index=$profile['index'];}//----------------------------------------------------------------------------------------------------------------------ID//----------------------------------------------------------------------------------------------------------------------Window Titleif($id or $_POST['apps_send']){    window(lr('title_apps_edit'));}else{    window(lr('title_apps_create'));}//----------------------------------------------------------------------------------------------------------------------if($id or $_POST['apps_send'])    $menu=array('apps_edit_profile','apps_edit_files');else    $menu=array('apps_edit_profile');$q=submenu(array('content','apps-create','apps_edit_profile'),$menu,1);contenu_a();if($q==1){    //==================================================================================================================VÅ¡echny aplikace    //----------------------------------------------------------------------------------------------------------------------Saving        if($id or $_POST['apps_send'])            success('apps_create_goto_files');        if($_POST['apps_send']){            //----------------------------------------------------Errors            if(!trim($apps_name)){                error(lr('apps_error_noname'));            }elseif(!trim($apps_description)){                error(lr('apps_error_notext'));            }else {                if(!$apps_permalink)                    $apps_permalink=$apps_name;                $apps_permalink=name2permalink($apps_permalink);                if(!$id){                    if ($_POST['apps_id']) {                        $id = intval($_POST['apps_id']);                    } else {                        $id = nextid();                    }                }                $GLOBALS['ss']['apps_edit_id']=$id;                $profile=new profile();                $profile->add('editor',$apps_editor);                $profile->add('index',$apps_index);                $profile->add('description',$apps_description);                $profile=$profile->vals2str();                if (ifobject($id,true)) {                    //----------------------------------------------------UPDATE                    trackobject($id);                    //------------------UPDATE objects                    sql_update('objects', "id='$id'", array(                        'id' => $id,                        'name' => $apps_name,                        'permalink' => $apps_permalink,                        'type' => 'app',                        'userid' => '',                        'origin' => '',                        'fp' => '',                        'func' => '',                        'hold' => '',                        'res' => '',                        'profile' => $profile,                        'set' => '',                        'own' => $GLOBALS['ss']['logid'],//@todo Takhle?                        't' => '',                        'pt' => ''                    ));                    //------------------UPDATE positions                    sql_update('positions', "id='$id'", array(                        'id' => $id,                        'ww' => -1,                        'x' => 0,                        'y' => 0,                        'traceid' => '',                        'starttime' => time(),                        'readytime' => 0,                        'stoptime' => 0                    ));                    //----------------------------------------------------                } else {                    //----------------------------------------------------INSERT NEW                    //------------------INSERT objects                    sql_insert('objects', array(                        'id' => $id,                        'name' => $apps_name,                        'permalink' => $apps_permalink,                        'type' => 'app',                        'userid' => '',                        'origin' => '',                        'fp' => '',                        'func' => '',                        'hold' => '',                        'res' => '',                        'profile' => $profile,                        'set' => '',                        'own' => $GLOBALS['ss']['logid'],//@todo Takhle?                        't' => '',                        'pt' => ''                    ));                    //------------------INSERT positions                    sql_insert('positions', array(                        'id' => $id,                        'ww' => -1,                        'x' => 0,                        'y' => 0,                        'traceid' => '',                        'starttime' => time(),                        'readytime' => 0,                        'stoptime' => 0                    ));                    //----------------------------------------------------                }                $tmpobject=new object($id);                $tmpobject->update(true);                unset($tmpobject);                //centerurl()                click('e=map;noi=1;');            }        }    //----------------------------------------------------------------------------------------------------------------------Form        form_a('','apps_form');        $style='font-size:22px; background-color: #222;color:#fff;border: 2px solid #171717;width: 100%';        $style2='font-size:17px;width: 100%;height:350px;border: 2px solid #171717; background-color: #222;color:#fff;';        $style3='font-size:22px; background-color: rgba(10,10,10,0.7);color:#fff;border: none;text-align:right;';        input_hidden('apps_send',1);        input_hidden('apps_id',$id?$id:0);        if($id) {            br();            tfont(url,16,'777777');            input_text('apps_permalink',$apps_permalink,200,'','font-size:16px;color:#ffffff;width: 200px;border: none;background-color: rgba(0,0,0,0);',lr('apps_permalink'));            //br();            //tfont(lr('apps_id') . ': ' . $id, 22);            br(2);        }        input_text('apps_name',$apps_name,200,'',$style,'*'.lr('apps_name'));        input_textarea('apps_description',$apps_description,15,3,$style2,'*'.lr('apps_description'));        br(2);        e('<span style="'.$style3.'">'.lr('apps_index').'</span>');        input_text('apps_index',$apps_index?$apps_index:'index',200,12,$style3,'index');        e('<span style="'.$style3.'">.php</span>');        br();        le('apps_editor');br();        input_text('apps_editor',$apps_editor,200,'',$style);        br(2);        form_send(lr('apps_send'),'font-size:18px;width:100%;color: #cccccc;border: 2px solid #555555; background-color: rgba(40,20,40,1);');        form_b();        form_js('content','?e=apps-create',array('apps_name','apps_editor','apps_index','apps_permalink','apps_description','apps_send','apps_id'));        ?>    </form>    <?php    //==================================================================================================================}elseif($q==2) {    //==================================================================================================================Moje aplikace    if($id) {        ?>        <style>        .dropbox{            padding:5px;            border: 2px dashed #227788;            background-color: #000011;        }        .dropboxFile{            /*width:100px;*/            margin:5px;            padding:5px;            display: block;            background-color: rgba(70,70,70,0.2);        }        </style>        <div id="dropbox" class="dropbox" style="width: 100%;height: 100vh;margin:5px;">            <?php            $dir='userdata/objects/' . $id . '/';            if(isset($GLOBALS['get']['deletefile'])){                $file=$GLOBALS['get']['deletefile'];                unlink($dir.basename($file));            }            $files = glob($dir.'*');            sort($files);            if (count($files) < 1) {                le('apps_files');            } else {                foreach ($files as $file) {                    $file=str_replace($dir,'',$file);                    echo('<div class="dropboxFile">'                        .iconr('e=content;ee=apps-create;submenu=2;prompt='.lr('apps_delete_file_prompt').';deletefile='.$file,"close",lr('delete'),15)                        .nbsp3                        . $file . '</div>');                }            }            ?>        </div>        <script>            $(function () {                $('#dropbox').filedrop({                    // The name of the $_FILES entry:                    paramname: 'file',                    maxfiles: 20,                    maxfilesize: <?=intval(ini_get('post_max_size')); ?>,                    url: '?e=create-post_file&id=<?=$id?>',                    uploadFinished: function (i, file, response) {                        $.data(file).addClass('done');                        // response is the JSON object that post_file.php returns                    },                    error: function(err, file) {                        switch(err) {                            case 'BrowserNotSupported':                                alert('<?= lr('upload_error_browser_not_supported') ?>');                                break;                            case 'TooManyFiles':                                // user uploaded more than 'maxfiles'                                alert('<?= lr('upload_error_more_files',1) ?>');                                break;                            case 'FileTooLarge':                                // program encountered a file whose size is greater than 'maxfilesize'                                // FileTooLarge also has access to the file which was too large                                // use file.name to reference the filename of the culprit file                                alert('<?= lr('upload_error_file_too_large',intval(ini_get('post_max_size'))) ?>');                                break;                            case 'FileExtensionNotAllowed':                                // The file extension is not in the specified list 'allowedfileextensions'                                alert('<?= lr('upload_error_wrong_extension','.jpg, .jpeg, .png, .gif, .bmp nebo .wbmp'); ?>');                                break;                            default:                                break;                        }                    },                    beforeEach: function(file){                        startloading();                    },                    uploadFinished: function(i, file, response, time) {                        <?php urlx('e=content;ee=apps-create;id='.$id.';'.js2('stoploading()'),0) ?>                    }                });            });        </script>    <?php    }else{        blue(lr('apps_create_profile_before_files'));    }    //==================================================================================================================}contenu_b();?>